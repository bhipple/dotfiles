#!/usr/bin/env zsh
most_recent=$(ls -lrt $HOME/.vscode-server/bin | tail -1 | awk '{print $NF}')
script="$HOME/.vscode-server/bin/$most_recent/bin/remote-cli/code"
if [[ -z ${script} ]]; then
    echo "VSCode remote script not found"
    exit 1
fi

socket=$(ls -lrt /run/user/$UID/vscode-ipc-* | tail -1 | awk '{print $NF}')
if [[ -z ${socket} ]]; then
    echo "VSCode IPC socket not found"
    exit 1
fi

export VSCODE_IPC_HOOK_CLI=${socket}
${script} $@
