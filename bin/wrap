#!/usr/bin/env zsh
set -euxo pipefail

echo "Setting up bwrap in `pwd`"

dir=$(pwd)
cmd=$@

bwrap \
  --unshare-all \
  --share-net \
  --tmpfs /tmp \
  --proc /proc \
  --dev /dev \
  --bind $dir $dir \
  --ro-bind /etc /etc \
  --ro-bind /nix /nix \
  --ro-bind /bin /bin \
  --ro-bind /run/current-system /run/current-system \
  --ro-bind ~/.nix-profile ~/.nix-profile \
  --ro-bind ~/dotfiles ~/dotfiles \
  --ro-bind ~/dotfiles_local ~/dotfiles_local \
  --ro-bind ~/.zshrc ~/.zshrc \
  --ro-bind ~/.zsh ~/.zsh \
  --ro-bind ~/.zgenom ~/.zgenom \
  --new-session \
  -- $cmd
