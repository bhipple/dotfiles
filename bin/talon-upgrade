#!/usr/bin/env zsh
# Hacky script to update my talon build
if [ -z $1 ]; then
    echo "USAGE: talon-upgrade <tar.gz url>"
    exit 1
fi

set -euxo pipefail

url=$1
version=$(basename $1 | sed 's|\.tar.xz$||' | sed 's|talon-linux-||')
hash=$(nix-prefetch-url $url)
sed -i "s|^  version = .*|  version = \"$version\";  # updated $(date -I)|"  ~/dotfiles/nur-packages/pkgs/talon/beta-src.nix
sed -i "s|^    url = .*|    url = \"$url\";|"                                ~/dotfiles/nur-packages/pkgs/talon/beta-src.nix
sed -i "s|^    sha256 = .*|    sha256 = \"$hash\";|"                         ~/dotfiles/nur-packages/pkgs/talon/beta-src.nix

nix build --no-link -L nixos.talon
nix-env -iA nixos.talon
