#!/usr/bin/env bash
notify-send "Connecting to bluetooth ..."

for _ in {1..10}; do
    if pacmd list-sinks | grep -q bluez; then
        notify-send "Successfully connected to headset!"
        break
    fi
    echo "Trying to connect to headset ..."
    echo -e 'connect 38:18:4C:7D:CA:CB' | sudo bluetoothctl
    sleep 2
done

# Set audio to headset
sink=$(pacmd list-sinks | grep -B1 bluez | head -1 | awk '{print $NF}')
audio $sink
